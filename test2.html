<!DOCTYPE html>
<html>
<head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <title>家庭医生首页</title>
    <style>
        body{
            background: rgba(225,225,225,0.5);
        }
        .fcs{
            width:100px;
            height:100px;
            border:1px solid black;
            margin:5px;
        }
        #c1{
            float:left;
            overflow: hidden;
        }
        #c2{
            float:left;
        }
        #c2 div{
            float:left;
        }
        #c3{
            float:left;
            overflow: hidden;
        }
    </style>
</head>
<body>
<div id="c1">
    <div class="fcs"></div>
    <div class="fcs"></div>
    <div class="fcs"></div>
    <div class="fcs"></div>
    <div class="fcs"></div>
    <div class="fcs"></div>
    <div class="fcs"></div>
</div>
<div id="c2">
    <div class="fcs"></div>
    <div class="fcs"></div>
    <div class="fcs"></div>
    <div class="fcs"></div>
    <div class="fcs"></div>
    <div class="fcs"></div>
    <div class="fcs"></div>
</div>
<div id="c3">
    <div class="fcs"></div>
    <div class="fcs"></div>
    <div class="fcs"></div>
    <div class="fcs"></div>
    <div class="fcs"></div>
    <div class="fcs"></div>
    <div class="fcs"></div>
</div>
<script>
    focusControl = (function() {
        var     menu = null,
                fcs = null,
                focusBox = null,
                lastPage = null,
                currentModule = null,
                currentFocus = null,
                lastModule = null,
                lastFocus = null,
                T = null;
        var GetQueryString = function (name) { //获取传入此页面的url参数
            var reg = new RegExp("(^|&)" + name + "=([^&]*)(&|$)");
            var r = window.location.search.substr(1).match(reg);
            if (r != null) return unescape(r[2]);
            return null;
        };
        function GetCurrentFocus(currentStr){//根据传入的字符串改变当前焦点
            var c = GetQueryString("focusNum") || currentStr;
            var m = c.split(",");
            currentModule = focusControl[m[0]];
            currentFocus = currentModule.focus[m[1]];
        }
        var focusObj = function (num, whichFcs) {
            var startFcs = whichFcs + num;
            console.log("对应的fcs为" + startFcs)
            this.ID = num;
            this.className = fcs[startFcs].className;
            this.x = fcs[startFcs].getBoundingClientRect().left;
            this.y = fcs[startFcs].getBoundingClientRect().top;
            this.w = fcs[startFcs].offsetWidth;
            this.h = fcs[startFcs].offsetHeight;
            this.link = fcs[startFcs].title ? fcs[startFcs].title : null;
            this.doClick = null;
            this.func = null;
        };
        var moduleObj = function (data, whichFcs) {
            this.name = data.name;
            this.focus = [];
            this.leftModule = data.leftModule || data.name;
            this.topModule = data.topModule || data.name;
            this.rightModule = data.rightModule || data.name;
            this.bottomModule = data.bottomModule || data.name;
            if(data.rule ==  "right"){
                for (var i = 0; i < data.num; i++) {
                    this.focus[i] = new focusObj(i, whichFcs - data.num);
                    this.focus[i].rightFocus = i == (data.num - 1) ? this.rightModule : i + 1;
                    this.focus[i].leftFocus = i == 0 ? this.leftModule : i - 1;
                }
            }else if(data.rule == "down"){
                for (var i = 0; i < data.num; i++) {
                    this.focus[i] = new focusObj(i, whichFcs - data.num);
                    this.focus[i].topFocus = i == 0 ? this.leftModule : i - 1;
                    this.focus[i].bottomFocus = i == (data.num - 1) ? this.rightModule : i + 1;
                }
            }
        };
        var onFocusStyle = function (async) {
            var index;
            function setOutline(obj) {
                obj.style.outline = "4px solid red";
                obj.style.outlineOffset = "1px";
                //obj.style.webkitBoxShadow="0 0 5px 5px #000";
                index = 1;
            }
            function delOutline(obj) {
                obj.style.outline = "none";
                obj.style.outlineOffset = "0px";
                obj.style.webkitBoxShadow = "none";
                index = 0;
            }
            function changeColor(obj) {
                if (index == 0) {
                    setOutline(obj);
                } else {
                    delOutline(obj);
                }
            }
            setOutline(focusBox);
            T = setInterval(function(){
                changeColor(focusBox)
            }, 500);
//            if(func != "" && func != undefined && async != false){
//                console.log("开始执行onfocs函数");
//                func(current);
//                console.log("执行完成onfocs函数");
//                console.warn("----------------我是华丽的分割线----------------")
//            }
        };
        var getFocus = function(focusStr){
            if(focusStr) GetCurrentFocus(focusStr);
            console.log("当前焦点块" , currentModule.name,",当前焦点" , currentFocus.ID);
            focusBox = document.createElement("div");
            focusBox.id = "focus-box";
            focusBox.style.top = currentFocus.y + "px";
            focusBox.style.left = currentFocus.x + "px";
            focusBox.style.width = currentFocus.w + "px";
            focusBox.style.height = currentFocus.h + "px";
            focusBox.style.position = "fixed";
            focusBox.style.zIndex = "888";
            document.body.appendChild(focusBox);
            onFocusStyle();
            lastModule = currentModule;
            lastFocus = currentFocus;
        };
        var loseFocus = function(){
            if (document.getElementById("focus-box") !== null) {
                var fcsBox = document.getElementById("focus-box");
                document.body.removeChild(fcsBox);
                clearInterval(T);
            }
        };
        return{
            mainInit : function (lastPageStr, data, currentStr) {
                console.log("%c开始初始化----mainInit","color:red");
                menu = document.getElementsByClassName("menu");
                fcs = document.getElementsByClassName("fcs");
                lastPage = lastPageStr;
                focusControl.moduleInit(data);
                getFocus(currentStr);
                console.log("%c初始化完成------mainInit","color:red");
            }
            ,
            moduleInit : function (data) {
                console.log("%c开始初始化------moduleInit","color:green");
                var whichFcs = 0;
                for( var i = 0; i < data.length; i++) {
                    whichFcs += data[i].num;
                    console.log("%c开始初始化模块------" + data[i].name,"color:blue");
                    focusControl[data[i].name] = new moduleObj(data[i], whichFcs);
                    console.log("%c初始化完成------" + data[i].name,"color:blue");
                }
                console.log("%c初始化完成------moduleInit","color:green");
            },
            moveFocus: function (key) {
                switch (key) {
                    case 8:
                        break;
                    case 13:
                        break;
                    case 37:
                        //焦点框左移
//                        if(typeof currentFocus.leftFocus == "undefined") {
//                            break;
//                        }else
                        if(typeof currentFocus.leftFocus == "number"){
                            currentFocus = currentModule.focus[currentFocus.leftFocus];
                        }else{
                            GetCurrentFocus(currentModule.leftModule)
                        }
                        break;
                    case 38:
                        //焦点框上移
                        if(typeof currentFocus.topFocus == "number") {
                            currentFocus = currentModule.focus[currentFocus.topFocus];
                        }else{
                            GetCurrentFocus(currentModule.topModule)
                        }
                        break;
                    case 39:
                        //焦点框右移
                        if(typeof currentFocus.rightFocus == "number"){
                            currentFocus = currentModule.focus[currentFocus.rightFocus];
                        }else{
                            GetCurrentFocus(currentModule.rightModule)
                        }
                        break;
                    case 40:
                        //焦点框下移
                        if(typeof currentFocus.bottomFocus == "number"){
                            currentFocus = currentModule.focus[currentFocus.bottomFocus];
                        }else{
                            GetCurrentFocus(currentModule.bottomModule)
                        }
                }
                if(currentFocus != lastFocus || currentModule != lastModule) {
                    loseFocus();
                    getFocus();
                }
            }
        }
    })();
    focusControl.mainInit("baidu.com", [{
        name : "mod0",
        num : 7,
        rule : "down",
        rightModule : "mod1,0"
    },{
        name : "mod1",
        num : 7,
        rule : "right",
        leftModule : "mod0,0",
        rightModule : "mod2,0"
    },{
        name : "mod2",
        num : 7,
        rule : "down",
        leftModule : "mod1,6"
    }], "mod0,1");
    window.document.onkeydown = function(keyEvent){
        keyEvent = keyEvent ? keyEvent : window.event;
        keyEvent.which = keyEvent.which ? keyEvent.which : keyEvent.keyCode;
        focusControl.moveFocus(keyEvent.which)
    };
    console.log(focusControl)
</script>
</body>
</html>